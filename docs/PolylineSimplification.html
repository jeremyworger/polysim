<!DOCTYPE html>

<html>
<head>
  <title>Polyline Simplification</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="GUI.html">
                  GUI.pde
                </a>
              
                
                <a class="source" href="Line.html">
                  Line.pde
                </a>
              
                
                <a class="source" href="LineFitter.html">
                  LineFitter.pde
                </a>
              
                
                <a class="source" href="Math.html">
                  Math.pde
                </a>
              
                
                <a class="source" href="Path.html">
                  Path.pde
                </a>
              
                
                <a class="source" href="PathSimplifier.html">
                  PathSimplifier.pde
                </a>
              
                
                <a class="source" href="PolylineSimplification.html">
                  PolylineSimplification.pde
                </a>
              
                
                <a class="source" href="SimplePathHull.html">
                  SimplePathHull.pde
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="polyline-simplification">Polyline Simplification</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>This project demostrates an original algorithm for polygonal line
simplification. Given a polygonal line, referred to as <em>path</em>, we produce
a visually similar path, but with less vertices. The restruction criterion is
<em>threshold</em>, which specifies the maximal distance between a point from
original path to the simplified path.</p>
<p>The algorithm is, implemented by <a href="PathSimplifier.html"><code>PathSimplifier</code></a>. It
receives an instance of <a href="PathSimplifier.html"><code>Path</code></a> as input and provides
a simplified path as result. The simplest use case may be as follows:</p>
<pre><code>Path path = <span class="hljs-keyword">new</span> Path();
<span class="hljs-keyword">float</span> threshold = <span class="hljs-number">0.3f</span>;
PathSimplifier simplifier = <span class="hljs-keyword">new</span> PathSimplifier(path, threshold);
path.addPoint(<span class="hljs-number">3</span>, <span class="hljs-number">0</span>);
path.addPoint(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
. . .
path.addPoint(-<span class="hljs-number">4</span>, <span class="hljs-number">1</span>);
Path simple = simplifier.getSimplified();
</code></pre><p>For details, refer to the implementation.</p>
<p><em>This file contains the implementation of the demo app. No documentation
provided, sorry.</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> MAX_SPARSE_POINT_RATE = <span class="hljs-number">13</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> POINT_SIZE = <span class="hljs-number">7</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> POINT_STROKE_WEIGHT = <span class="hljs-number">1</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> PATH_WEIGHT = <span class="hljs-number">2</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SIMPLE_WEIGHT = <span class="hljs-number">4</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> ERROR_BOX_WEIGHT = <span class="hljs-number">2</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CONVEX_HULL_WEIGHT = <span class="hljs-number">2</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> UI_AREA_SIZE = <span class="hljs-number">350</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> DETAIL_POINT_COUNT = <span class="hljs-number">200</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> MIN_THRESHOLD = <span class="hljs-number">1</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> MAX_THRESHOLD = <span class="hljs-number">20</span>;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> INITIAL_THRESHOLD = <span class="hljs-number">2</span>;
<span class="hljs-keyword">final</span> color BACKGROUND_COLOR = #E8DFCC;
<span class="hljs-keyword">final</span> color UI_AREA_COLOR = #FFFEED;
<span class="hljs-keyword">final</span> color POINT_COLOR = #<span class="hljs-number">665</span>D49;
<span class="hljs-keyword">final</span> color PATH_COLOR = #<span class="hljs-number">998</span>B6D;
<span class="hljs-keyword">final</span> color SIMPLE_COLOR = #<span class="hljs-number">3</span>B2969;
<span class="hljs-keyword">final</span> color ERROR_BOX_COLOR = #<span class="hljs-number">36</span>CF72;
<span class="hljs-keyword">final</span> color ERROR_BOX_BAD_COLOR = #FF5D76;
<span class="hljs-keyword">final</span> color CONVEX_HULL_COLOR = #FFF533;
<span class="hljs-keyword">final</span> color CONVEX_HULL_BAD_COLOR = #FF5D76;
<span class="hljs-keyword">final</span> <span class="hljs-keyword">float</span> DETAIL_FOCUS_AREA = <span class="hljs-number">0.9f</span>;

PVector detailOffset = <span class="hljs-keyword">new</span> PVector(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="hljs-keyword">float</span> detailScale = <span class="hljs-number">4.0</span>;

<span class="hljs-keyword">boolean</span> drawing = <span class="hljs-keyword">false</span>;
<span class="hljs-keyword">int</span> lastPointMillis = <span class="hljs-number">0</span>;

Path path = <span class="hljs-keyword">new</span> Path();
Path simple = <span class="hljs-keyword">null</span>;
PathSimplifier simplifier;

Label generalLabel;
CheckBox showOriginal; Label showOriginalLabel;
CheckBox showSimple; Label showSimpleLabel;
Label thresholdLabel; Label thresholdValueLabel;
Slider thresholdSlider;

Label detailViewLabel;
CheckBox showErrorBox; Label showErrorBoxLabel;
CheckBox showConvexHull; Label showConvexHullLabel;
Label traceLabel;
Slider traceSlider;

Label inputMethodLabel; Button inputMethod; Button clear;
String inputMethodFreehand = <span class="hljs-string">"Freehand (F)"</span>;
String inputMethodSparse = <span class="hljs-string">"Sparse (S)"</span>;
String inputMethodPrecise = <span class="hljs-string">"Precise (P)"</span>;

Label originalLengthLabel;
Label simpleLengthLabel;
Label ratioLabel;

<span class="hljs-keyword">float</span> threshold = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  size(<span class="hljs-number">900</span>, <span class="hljs-number">650</span>);
  PFont regularFont = loadFont(<span class="hljs-string">"SourceCodePro-Regular-13.vlw"</span>);
  PFont captionFont = loadFont(<span class="hljs-string">"SourceCodePro-Bold-16.vlw"</span>);

  path.addListener(<span class="hljs-keyword">new</span> IPathListener () {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClear</span><span class="hljs-params">(Path sender)</span> </span>{
      simple = <span class="hljs-keyword">null</span>;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAddPoint</span><span class="hljs-params">(Path sender, PVector p)</span> </span>{
      lastPointMillis = millis();
      simple = <span class="hljs-keyword">null</span>;
      <span class="hljs-keyword">if</span> (sender.length() &lt; <span class="hljs-number">2</span>)
        <span class="hljs-keyword">return</span>;
      PVector q = sender.point(sender.length() - <span class="hljs-number">2</span>);
      detailOffset.add(Geometry.span(q, p).normalize().mult(<span class="hljs-number">0.05f</span>)).div(<span class="hljs-number">1.05f</span>);
    }
  });

  generalLabel = <span class="hljs-keyword">new</span> Label(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">20</span>,
    <span class="hljs-string">"General"</span>, captionFont
  );
  showOriginal = <span class="hljs-keyword">new</span> CheckBox(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">45</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>
  );
  showOriginal.checked = <span class="hljs-keyword">true</span>;
  showOriginalLabel = <span class="hljs-keyword">new</span> Label(
    width - UI_AREA_SIZE + <span class="hljs-number">40</span>, <span class="hljs-number">45</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-string">"Show original path"</span>, regularFont
  );
  showSimple = <span class="hljs-keyword">new</span> CheckBox(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">70</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>
  );
  showSimple.checked = <span class="hljs-keyword">true</span>;
  showSimpleLabel = <span class="hljs-keyword">new</span> Label(
    width - UI_AREA_SIZE + <span class="hljs-number">40</span>, <span class="hljs-number">70</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-string">"Show simplified path"</span>, regularFont
  );
  thresholdLabel = <span class="hljs-keyword">new</span> Label(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">100</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-string">"Threshold:"</span>, regularFont
  );
  textFont(regularFont);
  thresholdValueLabel = <span class="hljs-keyword">new</span> Label(
    width - <span class="hljs-number">15</span> - textWidth(<span class="hljs-string">"00.0px"</span>), <span class="hljs-number">100</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-keyword">null</span>, regularFont
  );
  thresholdSlider = <span class="hljs-keyword">new</span> Slider(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">125</span>,
    UI_AREA_SIZE - <span class="hljs-number">30</span>, <span class="hljs-number">15</span>
  );
  thresholdSlider.setValue(
    (INITIAL_THRESHOLD - MIN_THRESHOLD) /
    (MAX_THRESHOLD - MIN_THRESHOLD)
  );

  detailViewLabel = <span class="hljs-keyword">new</span> Label(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">160</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">20</span>,
    <span class="hljs-string">"Detail view"</span>, captionFont
  );
  showErrorBox = <span class="hljs-keyword">new</span> CheckBox(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">190</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>
  );
  showErrorBox.checked = <span class="hljs-keyword">true</span>;
  showErrorBoxLabel = <span class="hljs-keyword">new</span> Label(
    width - UI_AREA_SIZE + <span class="hljs-number">40</span>, <span class="hljs-number">190</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-string">"Show error box"</span>, regularFont
  );
  showConvexHull = <span class="hljs-keyword">new</span> CheckBox(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">215</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>
  );
  showConvexHull.checked = <span class="hljs-keyword">true</span>;
  showConvexHullLabel = <span class="hljs-keyword">new</span> Label(
    width - UI_AREA_SIZE + <span class="hljs-number">40</span>, <span class="hljs-number">215</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-string">"Show convex hull"</span>, regularFont
  );
  traceLabel = <span class="hljs-keyword">new</span> Label(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">245</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-string">"Trace depth:"</span>, regularFont
  );
  traceSlider = <span class="hljs-keyword">new</span> Slider(
    width - UI_AREA_SIZE + <span class="hljs-number">15</span>, <span class="hljs-number">270</span>,
    UI_AREA_SIZE - <span class="hljs-number">30</span>, <span class="hljs-number">15</span>
  );
  traceSlider.setValue(<span class="hljs-number">1</span>);

  inputMethodLabel = <span class="hljs-keyword">new</span> Label(
    <span class="hljs-number">15</span>, <span class="hljs-number">17</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-string">"Input method:"</span>, regularFont
  );
  textFont(regularFont);
  inputMethod = <span class="hljs-keyword">new</span> Button(
    <span class="hljs-number">25</span> + textWidth(inputMethodLabel.value), <span class="hljs-number">12</span>,
    <span class="hljs-number">150</span>, <span class="hljs-number">23</span>,
    inputMethodFreehand, regularFont
  );
  clear = <span class="hljs-keyword">new</span> Button(
    width - UI_AREA_SIZE - <span class="hljs-number">115</span>, <span class="hljs-number">12</span>,
    <span class="hljs-number">100</span>, <span class="hljs-number">23</span>,
    <span class="hljs-string">"Clear (C)"</span>, regularFont
  );

  originalLengthLabel = <span class="hljs-keyword">new</span> Label(
    <span class="hljs-number">15</span>, height - <span class="hljs-number">75</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-keyword">null</span>, regularFont
  );
  simpleLengthLabel = <span class="hljs-keyword">new</span> Label(
    <span class="hljs-number">15</span>, height - <span class="hljs-number">50</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-keyword">null</span>, regularFont
  );
  ratioLabel = <span class="hljs-keyword">new</span> Label(
    <span class="hljs-number">15</span>, height - <span class="hljs-number">25</span>,
    <span class="hljs-number">15</span>, <span class="hljs-number">15</span>,
    <span class="hljs-keyword">null</span>, regularFont
  );

  IButtonListener buttonListener = <span class="hljs-keyword">new</span> IButtonListener() {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span><span class="hljs-params">(Button sender)</span> </span>{
      <span class="hljs-keyword">if</span> (sender == clear)
        path.clear();
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sender == inputMethod) {
        <span class="hljs-keyword">if</span> (inputMethod.value == inputMethodFreehand)
          inputMethod.value = inputMethodSparse;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (inputMethod.value == inputMethodSparse)
          inputMethod.value = inputMethodPrecise;
        <span class="hljs-keyword">else</span>
          inputMethod.value = inputMethodFreehand;
        path.clear();
      }
    }
  };
  inputMethod.addListener(buttonListener);
  clear.addListener(buttonListener);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateUIDataBindings</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">float</span> newThreshold = lerp(MIN_THRESHOLD, MAX_THRESHOLD, thresholdSlider.value());
  <span class="hljs-keyword">if</span> (newThreshold != threshold) {
    threshold = newThreshold;
    <span class="hljs-keyword">int</span> intPart = (<span class="hljs-keyword">int</span>)Math.floor(threshold);
    <span class="hljs-keyword">int</span> fracPart = (<span class="hljs-keyword">int</span>)((threshold - intPart) * <span class="hljs-number">10</span>);
    String intPartString = Integer.toString(intPart);
    <span class="hljs-keyword">if</span> (intPartString.length() &lt; <span class="hljs-number">2</span>)
      intPartString = <span class="hljs-string">" "</span> + intPartString;
    String fracPartString = Integer.toString(fracPart);
    thresholdValueLabel.value = intPartString + <span class="hljs-string">"."</span> + fracPartString + <span class="hljs-string">"px"</span>;
    simplifier = <span class="hljs-keyword">new</span> PathSimplifier(path, threshold);
    simple = <span class="hljs-keyword">null</span>;
  }

  <span class="hljs-keyword">if</span> (simple == <span class="hljs-keyword">null</span>);
    simple = simplifier.getSimplified();

  <span class="hljs-keyword">float</span> ratio = (<span class="hljs-keyword">float</span>)max(<span class="hljs-number">1</span>, simple.length()) / max(<span class="hljs-number">1</span>, path.length());
  <span class="hljs-keyword">int</span> intRatio = (<span class="hljs-keyword">int</span>)Math.round(ratio * <span class="hljs-number">100</span>);
  originalLengthLabel.value = <span class="hljs-string">"Original length:   "</span> + Integer.toString(path.length());
  simpleLengthLabel.value   = <span class="hljs-string">"Simplified length: "</span> + Integer.toString(simple.length());
  ratioLabel.value          = <span class="hljs-string">"Ratio:             "</span> + Integer.toString(intRatio) + <span class="hljs-string">"%"</span>;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw</span><span class="hljs-params">()</span> </span>{
  updateUIDataBindings();

  background(BACKGROUND_COLOR);

  drawDetail();

  rectMode(CORNER);
  noStroke();
  fill(UI_AREA_COLOR);
  rect(width - UI_AREA_SIZE, <span class="hljs-number">0</span>, UI_AREA_SIZE, height - UI_AREA_SIZE);
  fill(BACKGROUND_COLOR);
  rect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width - UI_AREA_SIZE, height);
  stroke(UI_AREA_COLOR);
  strokeWeight(<span class="hljs-number">1</span>);
  line(width - UI_AREA_SIZE, <span class="hljs-number">0</span>, width - UI_AREA_SIZE, height);

  drawNormal();

  Control.drawAll();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">drawNormal</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (path.isEmpty())
    <span class="hljs-keyword">return</span>;

  stroke(PATH_COLOR);
  strokeWeight(PATH_WEIGHT);
  <span class="hljs-keyword">if</span> (showOriginal.checked)
    drawPath(path, <span class="hljs-number">1</span>);

  stroke(SIMPLE_COLOR);
  strokeWeight(SIMPLE_WEIGHT);
  <span class="hljs-keyword">if</span> (showSimple.checked)
    drawPath(simple, <span class="hljs-number">1</span>);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">drawDetail</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (path.isEmpty())
    <span class="hljs-keyword">return</span>;

  pushMatrix();
  PVector offset = PVector.mult(detailOffset, DETAIL_FOCUS_AREA * UI_AREA_SIZE / <span class="hljs-number">2</span>);
  translate(
    width - UI_AREA_SIZE / <span class="hljs-number">2</span> + offset.x - detailScale * path.lastPoint().x,
    height - UI_AREA_SIZE / <span class="hljs-number">2</span> + offset.y - detailScale * path.lastPoint().y
  );

  stroke(PATH_COLOR);
  strokeWeight(PATH_WEIGHT);
  <span class="hljs-keyword">if</span> (showOriginal.checked)
    drawPath(path, detailScale);

  stroke(SIMPLE_COLOR);
  strokeWeight(SIMPLE_WEIGHT);
  <span class="hljs-keyword">if</span> (showSimple.checked)
    drawPath(simple, detailScale);

  <span class="hljs-keyword">if</span> (!showErrorBox.checked &amp;&amp; !showConvexHull.checked) {
    popMatrix();
    <span class="hljs-keyword">return</span>;
  }

  List&lt;PathSimplifier.Event&gt; trace = simplifier.trace;
  <span class="hljs-keyword">int</span> j = path.length() - <span class="hljs-number">1</span>;
  PVector pj = path.point(j);
  ErrorBox errorBox = <span class="hljs-keyword">new</span> ErrorBox(simplifier.fitter.fitLine(j, j), pj);
  SimplePathHull hull = <span class="hljs-keyword">new</span> SimplePathHull();
  hull.offer(pj);

  <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> k = (<span class="hljs-keyword">int</span>)(traceSlider.value() * (trace.size() - <span class="hljs-number">1</span>));
  <span class="hljs-keyword">final</span> PathSimplifier.Event e = trace.get(k);
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> iMin = e == PathSimplifier.Event.CUT ? j - k + <span class="hljs-number">1</span> : j - k;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = j - <span class="hljs-number">1</span>; i &gt;= iMin; --i) {
    PVector pi = path.point(i);
    <span class="hljs-keyword">if</span> (showErrorBox.checked) {
      Line line = simplifier.fitter.fitLine(i, j);
      errorBox.extend(line, pi);
    }
    <span class="hljs-keyword">if</span> (showConvexHull.checked)
      hull.offer(pi);
  }

  <span class="hljs-keyword">if</span> (showErrorBox.checked) {
    PVector[] corners = errorBox.getCartesianCorners();
    stroke(e != PathSimplifier.Event.THRESHOLD ? ERROR_BOX_COLOR : ERROR_BOX_BAD_COLOR);
    strokeWeight(ERROR_BOX_WEIGHT);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; corners.length; ++i) {
      PVector p0 = PVector.mult(corners[i], detailScale);
      PVector p1 = PVector.mult(corners[(i + <span class="hljs-number">1</span>) % corners.length], detailScale);
      line(p0.x, p0.y, p1.x, p1.y);
    }
  }

  <span class="hljs-keyword">if</span> (showConvexHull.checked) {
    stroke(
      e != PathSimplifier.Event.PIONEER_WEAK &amp;&amp; e != PathSimplifier.Event.PIONEER_STRONG
        ? CONVEX_HULL_COLOR : CONVEX_HULL_BAD_COLOR
    );
    strokeWeight(CONVEX_HULL_WEIGHT);
    SimplePathHull.Node n = hull.first();
    do {
      PVector p0 = PVector.mult(n.pos(), detailScale);
      PVector p1 = PVector.mult(n.next().pos(), detailScale);
      line(p0.x, p0.y, p1.x, p1.y);
      n = n.next();
    } <span class="hljs-keyword">while</span> (n != hull.first());
  }

  popMatrix();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">drawPath</span><span class="hljs-params">(Path path, <span class="hljs-keyword">float</span> scale)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; path.length(); ++i) {
    PVector p0 = PVector.mult(path.point(i - <span class="hljs-number">1</span>), scale);
    PVector p1 = PVector.mult(path.point(i), scale);
    line(p0.x, p0.y, p1.x, p1.y);
  }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mousePressed</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">if</span> (Control.mousePressedAll(mouseX, mouseY))
    <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">if</span> (mouseX &gt; width - UI_AREA_SIZE) {
    drawing = <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">if</span> (inputMethod.value != inputMethodPrecise)
    path.clear();
  path.addPoint(mouseX, mouseY);
  drawing = <span class="hljs-keyword">true</span>;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mouseDragged</span><span class="hljs-params">()</span> </span>{
  Control.mouseDraggedAll();

  <span class="hljs-keyword">if</span> (!drawing)
    <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">if</span> (
    inputMethod.value == inputMethodPrecise ||
    inputMethod.value == inputMethodSparse &amp;&amp;
    MAX_SPARSE_POINT_RATE * (millis() - lastPointMillis) &lt; <span class="hljs-number">1000</span>
  ) {
    <span class="hljs-keyword">return</span>;
  }

  path.addPoint(min(mouseX, width - UI_AREA_SIZE - PATH_WEIGHT), mouseY);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mouseReleased</span><span class="hljs-params">()</span> </span>{
  Control.mouseReleasedAll();
  drawing = <span class="hljs-keyword">false</span>;
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">keyPressed</span><span class="hljs-params">()</span> </span>{
  String newInputMethod = <span class="hljs-keyword">null</span>;
  <span class="hljs-keyword">switch</span> (key) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'c'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'C'</span>:
      path.clear();
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> <span class="hljs-string">'f'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>:
      newInputMethod = inputMethodFreehand;
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> <span class="hljs-string">'p'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'P'</span>:
      newInputMethod = inputMethodPrecise;
      <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'S'</span>:
      newInputMethod = inputMethodSparse;
      <span class="hljs-keyword">break</span>;
   }

   <span class="hljs-keyword">if</span> (newInputMethod != <span class="hljs-keyword">null</span> &amp;&amp; inputMethod.value != newInputMethod) {
     inputMethod.value = newInputMethod;
     path.clear();
   }
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
